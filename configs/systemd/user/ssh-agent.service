[Unit]
Description=OpenSSH private key agent
Wants=environment.target
Before=environment.target
IgnoreOnIsolate=true

[Service]
Type=forking
# Environment=SSH_AUTH_SOCK=%t/ssh-agent.socket
#PIDFile=%t/ssh-agent.pid
# ExecStart=/usr/bin/bash -c "eval `ssh-agent -a $SSH_AUTH_SOCK`"
ExecStart=/usr/bin/bash -c "eval `ssh-agent`"
ExecStartPost=/usr/bin/systemctl --user set-environment SSH_AUTH_SOCK=${SSH_AUTH_SOCK} SSH_AGENT_PID=${SSH_AGENT_PID}
# ExecStartPost=/bin/sh -c "ps x -o pid,comm|grep ssh-agent|cut -d' ' -f1 > %t/ssh-agent.pid"
#ExecStop=/usr/bin/ssh-agent -k

[Install]
WantedBy=default.target
